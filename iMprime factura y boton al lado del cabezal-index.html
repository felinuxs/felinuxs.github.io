<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Metas para PWA -->
    <title>Gestor Empresarial MÃ³vil</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gestor">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/3498db/ffffff?text=GE">

    
    <style>
        :root {
            --primary: #3498db;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #343a40;
            --background: #f8f9fa;
            --text: #343a40;
            --card-bg: white;
            --border: #ddd;
        }

        .tema-oscuro {
            --primary: #2980b9;
            --secondary: #2980b9;
            --background: #1a1a1a;
            --text: #f8f9fa;
            --card-bg: #2d2d2d;
            --border: #444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui;
            background: var(--background);
            color: var(--text);
            font-size: 16px;
            transition: background 0.3s, color 0.3s;
            padding-bottom: 30px;
        }

        .barra-buscadora {
            background: var(--primary);
            color: white;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .search-container {
            display: flex;
            align-items: center;
            position: relative;
        }

        .search-container input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            background: white;
            color: #333;
            text-transform: capitalize;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            color: var(--text);
            border-radius: 0 0 5px 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 1px solid var(--border);
        }

        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-result-item:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .result-actions {
            display: flex;
            gap: 5px;
        }

        .result-btn {
            padding: 3px 8px;
            border: none;
            border-radius: 3px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .btn-view {
            background: var(--secondary);
            color: white;
        }

        .btn-edit {
            background: var(--warning);
            color: white;
        }

        .btn-add {
            background: var(--success);
            color: white;
        }

        .btn-sell {
            background: var(--primary);
            color: white;
        }

        .container {
            width: 100%;
            padding: 10px;
            margin-top: 60px;
        }

        .menu-movil {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-movil {
            padding: 12px 8px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 0.95em;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            width: 100%;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-direction: column;
            height: 80px;
        }

        .btn-movil:hover {
            background: #2980b9;
        }

        .btn-movil:active {
            transform: scale(0.98);
        }

        .tipo-cambio-btn {
            font-size: 0.85em;
            line-height: 1.2;
            text-align: center;
        }

        .tipo-cambio-btn .tasa {
            font-size: 0.75em;
            font-weight: bold;
        }

        .tipo-cambio-btn .label {
            font-size: 0.85em;
            margin-top: 3px;
        }

        .nueva-pagina {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background);
            color: var(--text);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .nueva-pagina .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--primary);
            padding: 5px;
            position: absolute;
            right: 15px;
            top: 15px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th, table td {
            padding: 10px;
            border: 1px solid var(--border);
            text-align: left;
        }

        table th {
            background-color: var(--primary);
            color: white;
        }

        table tr:nth-child(even) {
            background-color: rgba(0,0,0,0.03);
        }

        table tr:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 1em;
            background: var(--card-bg);
            color: var(--text);
            text-transform: capitalize;
        }

        .btn {
            padding: 10px 15px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }

        .btn-primary {
            background-color: var(--secondary);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn:hover {
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            color: var(--text);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text);
        }

        .producto-venta {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .producto-info {
            flex: 1;
        }

        .producto-acciones {
            display: flex;
            gap: 5px;
        }

        .tipo-cambio-info {
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9em;
        }

        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .error {
            color: var(--danger);
            font-size: 0.9em;
            margin-top: 5px;
        }

        .config-option {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .config-option:last-child {
            border-bottom: none;
        }

        .watermark {
            position: fixed;
            bottom: 10px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.8em;
            color: #777;
            z-index: 999;
        }

        #modal-salida {
            display: none;
        }

        #modal-salida .modal-content {
            text-align: center;
        }

        #modal-salida .botones-confirmacion {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .factura-termica {
            width: 80mm;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: white;
            color: black;
            line-height: 1.2;
        }

        .factura-header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
        }

        .factura-items {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .factura-items th, .factura-items td {
            padding: 4px 0;
            border-bottom: 1px dashed #ccc;
        }

        .factura-total {
            margin-top: 10px;
            border-top: 2px solid #000;
            padding-top: 10px;
            text-align: right;
            font-weight: bold;
        }

        .capitalize {
            text-transform: capitalize;
        }

        .gasto-item, .empleado-item, .proveedor-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .reporte-item {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        .mensaje-item {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .mensaje-item.unread {
            background-color: rgba(52, 152, 219, 0.1);
        }

        /* Nuevos estilos para mejoras solicitadas */
        .btn-tema {
            background-color: var(--card-bg);
            color: var(--text);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
            border: 1px solid var(--border);
        }

        .botones-accion {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 10px;
        }

        .botones-accion .btn {
            flex: 1;
            text-align: center;
            padding: 12px 5px;
            font-size: 0.9em;
        }

        .botones-data {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .botones-data .btn {
            flex: 1;
            min-width: 100px;
            text-align: center;
        }

        .acciones-tabla {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .acciones-tabla .btn {
            padding: 6px 10px;
            font-size: 0.85em;
            margin: 2px;
        }

        .exportar-factura {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .exportar-factura .btn {
            flex: 1;
        }

        /* Nuevos estilos para modales de exportaciÃ³n */
        .modal-exportacion {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-exportacion .modal-content {
            background: var(--card-bg);
            color: var(--text);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .opcion-exportacion {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .opcion-exportacion:last-child {
            border-bottom: none;
        }

        .opcion-exportacion:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .icono-exportacion {
            font-size: 24px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }

        .texto-exportacion {
            flex: 1;
        }

        .texto-exportacion h4 {
            margin-bottom: 5px;
        }

        .texto-exportacion p {
            font-size: 0.9em;
            color: #777;
        }

        /* Estilos para formularios de email y SMS */
        .formulario-envio {
            margin-top: 15px;
        }

        .formulario-envio .form-group {
            margin-bottom: 10px;
        }

        .formulario-envio label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .formulario-envio input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 0.9em;
        }

        .botones-envio {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
    </style>
    <!-- Biblioteca para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Biblioteca para capturar HTML como imagen -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <!-- Barra de BÃºsqueda Inteligente -->
    <div class="barra-buscadora">
        <div class="search-container">
            <input type="text" id="buscador-global" placeholder="Buscar productos, clientes, proveedores..." autocomplete="off">
            <div class="search-results" id="resultados-busqueda"></div>
        </div>
    </div>

    <div class="container">
        <!-- MenÃº de Botones con 10 opciones - TamaÃ±o uniforme -->
        <div class="menu-movil">
            <button class="btn-movil" onclick="abrirPagina('ventas')">ð Ventas</button>
            <button class="btn-movil" onclick="abrirPagina('inventario')">ð¦ Inventario</button>
            <button class="btn-movil" onclick="abrirPagina('clientes')">ð¥ Clientes</button>
            <button class="btn-movil" onclick="abrirPagina('proveedores')">ð Proveedores</button>
            <button class="btn-movil" onclick="abrirPagina('gastos')">ð¸ Gastos</button>
            <button class="btn-movil" onclick="abrirPagina('empleados')">ð¨âð¼ Empleados</button>
            <button class="btn-movil tipo-cambio-btn" onclick="abrirPagina('tipo-cambio')">
                <div>ðµ</div>
                <div class="tasa" id="tipo-cambio-btn">1$ = 168 Bs</div>
                <div class="label">DÃ³lar</div>
            </button>
            <button class="btn-movil" onclick="abrirPagina('mensajes')">ð¨ Mensajes</button>
            <button class="btn-movil" onclick="abrirPagina('reportes')">ð Reportes</button>
            <button class="btn-movil" onclick="abrirPagina('config')">âï¸ ConfiguraciÃ³n</button>
        </div>
    </div>

    <!-- Marca de agua -->
    <div class="watermark">@felinuxs</div>

    <!-- PÃ¡gina de Ventas -->
    <div id="pagina-ventas" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('ventas')">&times;</button>
        <h2>ð Ventas</h2>
        
        <div class="tipo-cambio-info">
            Tipo de cambio: <span id="tipo-cambio-venta">1$ = 168 Bs</span>
        </div>
        
        <div class="form-group">
            <label for="cliente-venta">Cliente:</label>
            <div class="search-container">
                <input type="text" id="buscador-cliente-venta" placeholder="Buscar cliente..." autocomplete="off">
                <div class="search-results" id="resultados-cliente-venta"></div>
            </div>
            <button class="btn btn-success" style="margin-top: 5px; width: 100%;" onclick="mostrarModal('modal-nuevo-cliente')">+ Nuevo Cliente</button>
        </div>
        
        <div class="form-group">
            <label for="producto-venta">Producto:</label>
            <div class="search-container">
                <input type="text" id="buscador-producto-venta" placeholder="Buscar producto..." autocomplete="off">
                <div class="search-results" id="resultados-producto-venta"></div>
            </div>
        </div>
        
        <div id="productos-seleccionados"></div>
        
        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 5px;">
            <h3>Resumen de Venta</h3>
            <p>Total: <span id="total-bs">0.00</span> Bs</p>
        </div>
        
        <div class="botones-accion">
            <button class="btn btn-success" onclick="finalizarVenta()">Finalizar Venta</button>
            <button class="btn btn-primary" onclick="mostrarFactura()">Ver Factura</button>
        </div>
    </div>

    <!-- PÃ¡gina de Inventario -->
    <div id="pagina-inventario" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('inventario')">&times;</button>
        <h2>ð¦ Inventario</h2>
        
        <div class="search-container" style="margin-bottom: 15px;">
            <input type="text" id="buscador-inventario" placeholder="Buscar en inventario..." autocomplete="off">
            <div class="search-results" id="resultados-inventario"></div>
        </div>
        
        <button class="btn btn-success" onclick="mostrarModal('modal-agregar-producto')">+ Agregar Producto</button>
        
        <table id="tabla-inventario">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Precio USD</th>
                    <th>Precio Bs</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- PÃ¡gina de Clientes -->
    <div id="pagina-clientes" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('clientes')">&times;</button>
        <h2>ð¥ Clientes</h2>
        
        <div class="search-container" style="margin-bottom: 15px;">
            <input type="text" id="buscador-clientes" placeholder="Buscar clientes..." autocomplete="off">
            <div class="search-results" id="resultados-clientes"></div>
        </div>
        
        <button class="btn btn-success" onclick="mostrarModal('modal-nuevo-cliente')">+ Agregar Cliente</button>
        
        <table id="tabla-clientes">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>TelÃ©fono</th>
                    <th>Email</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- PÃ¡gina de Proveedores -->
    <div id="pagina-proveedores" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('proveedores')">&times;</button>
        <h2>ð Proveedores</h2>
        
        <div class="search-container" style="margin-bottom: 15px;">
            <input type="text" id="buscador-proveedores" placeholder="Buscar proveedores..." autocomplete="off">
            <div class="search-results" id="resultados-proveedores"></div>
        </div>
        
        <button class="btn btn-success" onclick="mostrarModal('modal-agregar-proveedor')">+ Agregar Proveedor</button>
        
        <div id="lista-proveedores">
            <!-- Los proveedores se cargarÃ¡n aquÃ­ -->
        </div>
    </div>

    <!-- PÃ¡gina de Gastos -->
    <div id="pagina-gastos" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('gastos')">&times;</button>
        <h2>ð¸ Gastos</h2>
        
        <div class="form-group">
            <label for="filtro-fecha-gastos">Filtrar por fecha:</label>
            <input type="month" id="filtro-fecha-gastos" onchange="filtrarGastos()">
        </div>
        
        <button class="btn btn-success" onclick="mostrarModal('modal-agregar-gasto')">+ Registrar Gasto</button>
        
        <div id="resumen-gastos" class="card">
            <h3>Resumen del Mes</h3>
            <p>Total Gastos: <span id="total-gastos">0.00</span> Bs</p>
            <p>Por CategorÃ­a:</p>
            <ul id="categorias-gastos"></ul>
        </div>
        
        <div id="lista-gastos">
            <!-- Los gastos se cargarÃ¡n aquÃ­ -->
        </div>
    </div>

    <!-- PÃ¡gina de Empleados -->
    <div id="pagina-empleados" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('empleados')">&times;</button>
        <h2>ð¨âð¼ Empleados</h2>
        
        <div class="search-container" style="margin-bottom: 15px;">
            <input type="text" id="buscador-empleados" placeholder="Buscar empleados..." autocomplete="off">
            <div class="search-results" id="resultados-empleados"></div>
        </div>
        
        <button class="btn btn-success" onclick="mostrarModal('modal-agregar-empleado')">+ Agregar Empleado</button>
        
        <div id="lista-empleados">
            <!-- Los empleados se cargarÃ¡n aquÃ­ -->
        </div>
    </div>

    <!-- PÃ¡gina de Tipo de Cambio -->
    <div id="pagina-tipo-cambio" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('tipo-cambio')">&times;</button>
        <h2>ðµ Tipo de Cambio</h2>
        
        <div class="card">
            <h3>Tipo de Cambio Actual</h3>
            <p>1 USD = <span id="tipo-cambio-actual">168</span> Bs</p>
            <p>Ãltima actualizaciÃ³n: <span id="fecha-actualizacion">01/01/2023</span></p>
        </div>
        
        <div class="form-group">
            <label for="nuevo-tipo-cambio">Nuevo Tipo de Cambio (Bs por USD):</label>
            <input type="number" id="nuevo-tipo-cambio" step="0.01" min="1" value="168">
        </div>
        
        <button class="btn btn-primary" onclick="actualizarTipoCambio()">Actualizar Tipo de Cambio</button>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Historial de Cambios</h3>
            <div id="historial-tipo-cambio">
                <!-- El historial se cargarÃ¡ aquÃ­ -->
            </div>
        </div>
    </div>

    <!-- PÃ¡gina de Mensajes -->
    <div id="pagina-mensajes" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('mensajes')">&times;</button>
        <h2>ð¨ Mensajes</h2>
        
        <div class="search-container" style="margin-bottom: 15px;">
            <input type="text" id="buscador-mensajes" placeholder="Buscar mensajes..." autocomplete="off">
        </div>
        
        <div id="filtros-mensajes" style="margin-bottom: 15px;">
            <button class="btn btn-primary" onclick="filtrarMensajes('todos')">Todos</button>
            <button class="btn btn-primary" onclick="filtrarMensajes('no-leidos')">No LeÃ­dos</button>
            <button class="btn btn-primary" onclick="filtrarMensajes('importantes')">Importantes</button>
        </div>
        
        <div id="lista-mensajes">
            <!-- Los mensajes se cargarÃ¡n aquÃ­ -->
        </div>
    </div>

    <!-- PÃ¡gina de Reportes -->
    <div id="pagina-reportes" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('reportes')">&times;</button>
        <h2>ð Reportes</h2>
        
        <div class="card">
            <h3>Generar Reporte</h3>
            <div class="form-group">
                <label for="tipo-reporte">Tipo de Reporte:</label>
                <select id="tipo-reporte">
                    <option value="ventas">Ventas</option>
                    <option value="inventario">Inventario</option>
                    <option value="gastos">Gastos</option>
                    <option value="clientes">Clientes</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="fecha-inicio">Fecha Inicio:</label>
                <input type="date" id="fecha-inicio">
            </div>
            
            <div class="form-group">
                <label for="fecha-fin">Fecha Fin:</label>
                <input type="date" id="fecha-fin">
            </div>
            
            <button class="btn btn-primary" onclick="generarReporte()">Generar Reporte</button>
        </div>
        
        <div id="contenedor-reporte" style="margin-top: 20px;">
            <!-- El reporte generado se mostrarÃ¡ aquÃ­ -->
        </div>
    </div>

    <!-- PÃ¡gina de ConfiguraciÃ³n -->
    <div id="pagina-config" class="nueva-pagina">
        <button class="close-btn" onclick="cerrarPagina('config')">&times;</button>
        <h2>âï¸ ConfiguraciÃ³n</h2>
        
        <div class="config-option">
            <h3>Apariencia</h3>
            <button class="btn btn-tema" id="btn-cambiar-tema" onclick="cambiarTema()">Cambiar a Modo Oscuro</button>
        </div>
        
        <div class="config-option">
            <h3>PrevenciÃ³n de Cierre</h3>
            <button class="btn btn-primary" onclick="activarPrevencionCierre()">Activar PrevenciÃ³n de Cierre</button>
            <button class="btn btn-danger" onclick="desactivarPrevencionCierre()">Desactivar PrevenciÃ³n de Cierre</button>
            <p id="estado-prevencion" style="margin-top: 10px; font-size: 0.9em;">Estado: Inactivo</p>
        </div>
        
        <div class="config-option">
            <h3>Datos</h3>
            <div class="botones-data">
                <button class="btn btn-primary" onclick="respaldarDatos()">Respaldar Datos</button>
                <button class="btn btn-warning" onclick="restaurarDatos()">Restaurar Datos</button>
                <button class="btn btn-danger" onclick="mostrarModal('modal-salida')">Eliminar Datos</button>
            </div>
        </div>
        
        <div class="config-option">
            <h3>Empresa</h3>
            <div class="form-group">
                <label for="nombre-empresa">Nombre de la Empresa:</label>
                <input type="text" id="nombre-empresa" value="MI EMPRESA">
            </div>
            <div class="form-group">
                <label for="rif-empresa">RIF:</label>
                <input type="text" id="rif-empresa" value="J-123456789">
            </div>
            <div class="form-group">
                <label for="telefono-empresa">TelÃ©fono:</label>
                <input type="text" id="telefono-empresa" value="(123) 456-7890">
            </div>
            <div class="form-group">
                <label for="direccion-empresa">DirecciÃ³n:</label>
                <textarea id="direccion-empresa">Av. Principal, Local #123</textarea>
            </div>
            <button class="btn btn-success" onclick="guardarConfiguracionEmpresa()">Guardar ConfiguraciÃ³n</button>
        </div>
        
        <div class="config-option">
            <h3>Acerca de</h3>
            <p>Gestor Empresarial MÃ³vil v1.0</p>
            <p>Desarrollado por @felinuxs</p>
        </div>
    </div>

    <!-- Modales para diferentes funcionalidades -->
    <div class="modal" id="modal-nuevo-cliente">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Cliente</h3>
                <button class="modal-close" onclick="cerrarModal('modal-nuevo-cliente')">&times;</button>
            </div>
            <form id="form-nuevo-cliente">
                <div class="form-group">
                    <label for="nombre-cliente-modal">Nombre:</label>
                    <input type="text" id="nombre-cliente-modal" class="capitalize" required>
                </div>
                <div class="form-group">
                    <label for="telefono-cliente-modal">TelÃ©fono:</label>
                    <input type="text" id="telefono-cliente-modal">
                </div>
                <div class="form-group">
                    <label for="email-cliente-modal">Email:</label>
                    <input type="email" id="email-cliente-modal">
                </div>
                <div class="form-group">
                    <label for="direccion-cliente-modal">DirecciÃ³n:</label>
                    <textarea id="direccion-cliente-modal" class="capitalize"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Guardar Cliente</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal-agregar-producto">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="titulo-modal-producto">Agregar Producto</h3>
                <button class="modal-close" onclick="cerrarModal('modal-agregar-producto')">&times;</button>
            </div>
            <form id="form-agregar-producto">
                <div class="form-group">
                    <label for="nombre-producto">Nombre:</label>
                    <input type="text" id="nombre-producto" class="capitalize">
                </div>
                <div class="form-group">
                    <label for="precio-usd-producto">Precio USD:</label>
                    <input type="number" id="precio-usd-producto" step="0.01" min="0" oninput="calcularPrecioBs()">
                </div>
                <div class="form-group">
                    <label for="precio-bs-producto">Precio Bs:</label>
                    <input type="number" id="precio-bs-producto" step="0.01" min="0" readonly>
                </div>
                <div class="form-group">
                    <label for="stock-producto">Stock:</label>
                    <input type="number" id="stock-producto" min="0">
                </div>
                <button type="submit" class="btn btn-success">Guardar Producto</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal-agregar-proveedor">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Proveedor</h3>
                <button class="modal-close" onclick="cerrarModal('modal-agregar-proveedor')">&times;</button>
            </div>
            <form id="form-agregar-proveedor">
                <div class="form-group">
                    <label for="nombre-proveedor">Nombre:</label>
                    <input type="text" id="nombre-proveedor" class="capitalize" required>
                </div>
                <div class="form-group">
                    <label for="contacto-proveedor">Persona de Contacto:</label>
                    <input type="text" id="contacto-proveedor" class="capitalize">
                </div>
                <div class="form-group">
                    <label for="telefono-proveedor">TelÃ©fono:</label>
                    <input type="text" id="telefono-proveedor">
                </div>
                <div class="form-group">
                    <label for="email-proveedor">Email:</label>
                    <input type="email" id="email-proveedor">
                </div>
                <div class="form-group">
                    <label for="productos-proveedor">Productos que suministra:</label>
                    <textarea id="productos-proveedor" class="capitalize"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Guardar Proveedor</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal-agregar-gasto">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registrar Gasto</h3>
                <button class="modal-close" onclick="cerrarModal('modal-agregar-gasto')">&times;</button>
            </div>
            <form id="form-agregar-gasto">
                <div class="form-group">
                    <label for="descripcion-gasto">DescripciÃ³n:</label>
                    <input type="text" id="descripcion-gasto" class="capitalize" required>
                </div>
                <div class="form-group">
                    <label for="categoria-gasto">CategorÃ­a:</label>
                    <select id="categoria-gasto">
                        <option value="oficina">Oficina</option>
                        <option value="servicios">Servicios</option>
                        <option value="impuestos">Impuestos</option>
                        <option value="nÃ³mina">NÃ³mina</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="monto-gasto">Monto (Bs):</label>
                    <input type="number" id="monto-gasto" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="fecha-gasto">Fecha:</label>
                    <input type="date" id="fecha-gasto" required>
                </div>
                <button type="submit" class="btn btn-success">Registrar Gasto</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal-agregar-empleado">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Empleado</h3>
                <button class="modal-close" onclick="cerrarModal('modal-agregar-empleado')">&times;</button>
            </div>
            <form id="form-agregar-empleado">
                <div class="form-group">
                    <label for="nombre-empleado">Nombre:</label>
                    <input type="text" id="nombre-empleado" class="capitalize" required>
                </div>
                <div class="form-group">
                    <label for="cargo-empleado">Cargo:</label>
                    <input type="text" id="cargo-empleado" class="capitalize">
                </div>
                <div class="form-group">
                    <label for="salario-empleado">Salario (Bs):</label>
                    <input type="number" id="salario-empleado" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="telefono-empleado">TelÃ©fono:</label>
                    <input type="text" id="telefono-empleado">
                </div>
                <div class="form-group">
                    <label for="fecha-contracto">Fecha de Contrato:</label>
                    <input type="date" id="fecha-contracto">
                </div>
                <button type="submit" class="btn btn-success">Guardar Empleado</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modal-factura">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Factura</h3>
                <button class="modal-close" onclick="cerrarModal('modal-factura')">&times;</button>
            </div>
            <div class="factura-termica">
                <div class="factura-header">
                    <h3 id="nombre-empresa-factura">MI EMPRESA</h3>
                    <p>RIF: <span id="rif-empresa-factura">J-123456789</span></p>
                    <p>TelÃ©fono: <span id="telefono-empresa-factura">(123) 456-7890</span></p>
                    <p>Fecha: <span id="factura-fecha"></span></p>
                </div>
                
                <div class="factura-cliente">
                    <p><strong>Cliente:</strong> <span id="factura-cliente-nombre"></span></p>
                </div>
                
                <table class="factura-items">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Cant</th>
                            <th>Precio</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="factura-items-body">
                    </tbody>
                </table>
                
                <div class="factura-total">
                    <p>Total: <span id="factura-total"></span> Bs</p>
                </div>
                
                <div class="factura-footer">
                    <p>Â¡Gracias por su compra!</p>
                </div>
            </div>
            <div class="exportar-factura">
                <button class="btn btn-primary" onclick="mostrarOpcionesExportacion()">Exportar/Imprimir Factura</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-salida">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Â¿Eliminar todos los datos?</h3>
            </div>
            <p>Â¿EstÃ¡ seguro que desea eliminar todos los datos? Esta acciÃ³n no se puede deshacer.</p>
            <div class="botones-confirmacion">
                <button class="btn btn-danger" onclick="eliminarTodosDatos()">SÃ­, eliminar</button>
                <button class="btn btn-primary" onclick="cerrarModal('modal-salida')">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de opciones de exportaciÃ³n -->
    <div class="modal-exportacion" id="modal-exportar">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Exportar Factura</h3>
                <button class="modal-close" onclick="cerrarModal('modal-exportar')">&times;</button>
            </div>
            
            <div class="opcion-exportacion" onclick="imprimirFactura()">
                <div class="icono-exportacion">ð¨ï¸</div>
                <div class="texto-exportacion">
                    <h4>Imprimir</h4>
                    <p>Imprimir factura directamente</p>
                </div>
            </div>
            
            <div class="opcion-exportacion" onclick="exportarFacturaPDF()">
                <div class="icono-exportacion">ð</div>
                <div class="texto-exportacion">
                    <h4>Exportar a PDF</h4>
                    <p>Guardar como documento PDF</p>
                </div>
            </div>
            
            <div class="opcion-exportacion" onclick="exportarFacturaJPEG()">
                <div class="icono-exportacion">ð¼ï¸</div>
                <div class="texto-exportacion">
                    <h4>Exportar a JPEG</h4>
                    <p>Guardar como imagen JPEG</p>
                </div>
            </div>
            
            <div class="opcion-exportacion" onclick="mostrarFormularioEmail()">
                <div class="icono-exportacion">ð§</div>
                <div class="texto-exportacion">
                    <h4>Enviar por Email</h4>
                    <p>Enviar factura por correo electrÃ³nico</p>
                </div>
            </div>
            
            <div class="opcion-exportacion" onclick="mostrarFormularioSMS()">
                <div class="icono-exportacion">ð¬</div>
                <div class="texto-exportacion">
                    <h4>Enviar por SMS</h4>
                    <p>Enviar factura por mensaje de texto</p>
                </div>
            </div>
            
            <!-- Formulario para email -->
            <div id="formulario-email" class="formulario-envio" style="display: none;">
                <div class="form-group">
                    <label for="email-destino">Email destino:</label>
                    <input type="email" id="email-destino" placeholder="correo@ejemplo.com">
                </div>
                <div class="botones-envio">
                    <button class="btn btn-primary" onclick="enviarFacturaEmail()">Enviar</button>
                    <button class="btn btn-danger" onclick="ocultarFormularios()">Cancelar</button>
                </div>
            </div>
            
            <!-- Formulario para SMS -->
            <div id="formulario-sms" class="formulario-envio" style="display: none;">
                <div class="form-group">
                    <label for="telefono-destino">TelÃ©fono destino:</label>
                    <input type="tel" id="telefono-destino" placeholder="+1234567890">
                </div>
                <div class="botones-envio">
                    <button class="btn btn-primary" onclick="enviarFacturaSMS()">Enviar</button>
                    <button class="btn btn-danger" onclick="ocultarFormularios()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== DATOS DE EJEMPLO =====
        let inventario = JSON.parse(localStorage.getItem('inventario')) || [
            {
                id: 1,
                nombre: "Maxicaucho",
                precioUSD: 9.00,
                precioBs: 80.64,
                stock: 10
            }
        ];

        let clientes = JSON.parse(localStorage.getItem('clientes')) || [
            {
                id: 1,
                nombre: "Juan PÃ©rez",
                telefono: "12345678",
                email: "juan@email.com",
                direccion: "Av. Siempre Viva 123"
            }
        ];

        let proveedores = JSON.parse(localStorage.getItem('proveedores')) || [
            {
                id: 1,
                nombre: "Distribuidora ABC",
                contacto: "MarÃ­a GonzÃ¡lez",
                telefono: "98765432",
                email: "contacto@distribuidoraabc.com",
                productos: "Materiales de oficina"
            }
        ];

        let gastos = JSON.parse(localStorage.getItem('gastos')) || [
            {
                id: 1,
                descripcion: "PapelerÃ­a",
                categoria: "oficina",
                monto: 150.50,
                fecha: "2023-05-15"
            }
        ];

        let empleados = JSON.parse(localStorage.getItem('empleados')) || [
            {
                id: 1,
                nombre: "Carlos RodrÃ­guez",
                cargo: "Vendedor",
                salario: 1200.00,
                telefono: "5551234",
                fechaContrato: "2023-01-10"
            }
        ];

        let mensajes = JSON.parse(localStorage.getItem('mensajes')) || [
            {
                id: 1,
                remitente: "Sistema",
                asunto: "Bienvenido al Gestor Empresarial",
                contenido: "Su sistema ha sido configurado correctamente.",
                fecha: "2023-05-01",
                leido: false,
                importante: true
            }
        ];

        let tipoCambio = parseFloat(localStorage.getItem('tipoCambio')) || 168;
        let historialTipoCambio = JSON.parse(localStorage.getItem('historialTipoCambio')) || [
            { fecha: "2023-05-01", tasa: 168 }
        ];

        let configuracion = JSON.parse(localStorage.getItem('configuracion')) || {
            tema: "claro",
            empresa: {
                nombre: "MI EMPRESA",
                rif: "J-123456789",
                telefono: "(123) 456-7890",
                direccion: "Av. Principal, Local #123"
            }
        };

        // Variables para la venta actual
        let ventaActual = {
            cliente: null,
            productos: [],
            totalUSD: 0,
            totalBs: 0
        };

        // Variable para controlar la prevenciÃ³n de cierre
        let prevencionCierreActiva = false;

        // ===== INICIALIZACIÃN =====
        document.addEventListener('DOMContentLoaded', function() {
            cargarInventario();
            cargarClientes();
            cargarProveedores();
            cargarGastos();
            cargarEmpleados();
            cargarMensajes();
            cargarConfiguracion();
            configurarBuscadorGlobal();
            configurarBuscadoresModulos();
            actualizarTipoCambioVisual();
            
            // Configurar event listeners para formularios
            document.getElementById('form-nuevo-cliente').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarNuevoClienteDesdeModal();
            });
            
            document.getElementById('form-agregar-producto').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarNuevoProducto();
            });
            
            document.getElementById('form-agregar-proveedor').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarNuevoProveedor();
            });
            
            document.getElementById('form-agregar-gasto').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarNuevoGasto();
            });
            
            document.getElementById('form-agregar-empleado').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarNuevoEmpleado();
            });
            
            // Configurar autocapitalizaciÃ³n en todos los inputs de texto
            document.querySelectorAll('input[type="text"], textarea').forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value.length === 1) {
                        this.value = this.value.charAt(0).toUpperCase() + this.value.slice(1);
                    }
                });
            });
            
            // Establecer fecha actual en los inputs de fecha
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha-gasto').value = hoy;
            document.getElementById('fecha-contracto').value = hoy;
            document.getElementById('fecha-inicio').value = hoy;
            document.getElementById('fecha-fin').value = hoy;
        });

        // ===== FUNCIONES DE EXPORTACIÃN =====

        // FunciÃ³n para mostrar el modal de exportaciÃ³n
        function mostrarOpcionesExportacion() {
            // Primero asegurÃ©monos de que la factura estÃ© actualizada
            mostrarFactura();
            // Luego mostramos el modal de exportaciÃ³n
            mostrarModal('modal-exportar');
        }

        // FunciÃ³n para ocultar formularios
        function ocultarFormularios() {
            document.getElementById('formulario-email').style.display = 'none';
            document.getElementById('formulario-sms').style.display = 'none';
        }

        // FunciÃ³n para mostrar formulario de email
        function mostrarFormularioEmail() {
            ocultarFormularios();
            document.getElementById('formulario-email').style.display = 'block';
        }

        // FunciÃ³n para mostrar formulario de SMS
        function mostrarFormularioSMS() {
            ocultarFormularios();
            document.getElementById('formulario-sms').style.display = 'block';
        }

        // FunciÃ³n para imprimir factura
        function imprimirFactura() {
            const contenido = document.querySelector('.factura-termica').innerHTML;
            const ventana = window.open('', '_blank');
            
            ventana.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Factura - ${configuracion.empresa.nombre}</title>
                    <style>
                        body { 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px; 
                            margin: 0;
                            padding: 10px;
                        }
                        .factura-termica { 
                            width: 80mm; 
                            margin: 0 auto;
                        }
                        .factura-header { 
                            text-align: center; 
                            margin-bottom: 10px; 
                            border-bottom: 1px dashed #000; 
                            padding-bottom: 10px; 
                        }
                        .factura-items { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 10px 0; 
                        }
                        .factura-items th, .factura-items td { 
                            padding: 4px 0; 
                            border-bottom: 1px dashed #ccc; 
                        }
                        .factura-total { 
                            margin-top: 10px; 
                            border-top: 2px solid #000; 
                            padding-top: 10px; 
                            text-align: right; 
                            font-weight: bold; 
                        }
                        @media print {
                            body { 
                                width: 80mm;
                                margin: 0;
                                padding: 0;
                            }
                            .factura-termica {
                                width: 80mm;
                                padding: 10px;
                            }
                        }
                    </style>
                </head>
                <body onload="window.print(); setTimeout(() => window.close(), 500);">
                    ${contenido}
                </body>
                </html>
            `);
            ventana.document.close();
        }

        // FunciÃ³n para exportar a PDF
        function exportarFacturaPDF() {
            // Usamos html2canvas para capturar la factura como imagen
            html2canvas(document.querySelector('.factura-termica')).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Creamos el PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', [80, document.querySelector('.factura-termica').scrollHeight / 3.5]);
                
                pdf.addImage(imgData, 'JPEG', 0, 0, 80, document.querySelector('.factura-termica').scrollHeight / 3.5);
                
                // Guardamos el PDF
                pdf.save(`Factura_${configuracion.empresa.nombre}_${new Date().toISOString().split('T')[0]}.pdf`);
                
                alert('Factura exportada como PDF correctamente');
            });
        }

        // FunciÃ³n para exportar a JPEG
        function exportarFacturaJPEG() {
            html2canvas(document.querySelector('.factura-termica')).then(canvas => {
                // Crear un enlace para descargar la imagen
                const link = document.createElement('a');
                link.download = `Factura_${configuracion.empresa.nombre}_${new Date().toISOString().split('T')[0]}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                
                alert('Factura exportada como JPEG correctamente');
            });
        }

        // FunciÃ³n para enviar por email (simulaciÃ³n)
        function enviarFacturaEmail() {
            const email = document.getElementById('email-destino').value;
            
            if (!email || !email.includes('@')) {
                alert('Por favor ingrese un email vÃ¡lido');
                return;
            }
            
            // En una aplicaciÃ³n real, aquÃ­ se conectarÃ­a con un servicio de email
            // Por ahora simulamos el envÃ­o
            html2canvas(document.querySelector('.factura-termica')).then(canvas => {
                alert(`Factura enviada por email a: ${email}\n\nEn una implementaciÃ³n real, esto enviarÃ­a la factura adjunta por correo electrÃ³nico.`);
                cerrarModal('modal-exportar');
            });
        }

        // FunciÃ³n para enviar por SMS (simulaciÃ³n)
        function enviarFacturaSMS() {
            const telefono = document.getElementById('telefono-destino').value;
            
            if (!telefono) {
                alert('Por favor ingrese un nÃºmero de telÃ©fono');
                return;
            }
            
            // En una aplicaciÃ³n real, aquÃ­ se conectarÃ­a con un servicio de SMS
            // Por ahora simulamos el envÃ­o
            alert(`Factura enviada por SMS al nÃºmero: ${telefono}\n\nEn una implementaciÃ³n real, esto enviarÃ­a un enlace a la factura por mensaje de texto.`);
            cerrarModal('modal-exportar');
        }

        // ===== FUNCIONES DE PÃGINAS =====
        function abrirPagina(paginaId) {
            document.querySelectorAll('.nueva-pagina').forEach(pagina => {
                pagina.style.display = 'none';
            });
            document.getElementById(`pagina-${paginaId}`).style.display = 'block';
            
            // Cargar datos especÃ­ficos de cada pÃ¡gina
            switch(paginaId) {
                case 'inventario':
                    cargarInventario();
                    break;
                case 'ventas':
                    reiniciarVenta();
                    break;
                case 'clientes':
                    cargarClientes();
                    break;
                case 'proveedores':
                    cargarProveedores();
                    break;
                case 'gastos':
                    cargarGastos();
                    break;
                case 'empleados':
                    cargarEmpleados();
                    break;
                case 'tipo-cambio':
                    cargarHistorialTipoCambio();
                    break;
                case 'mensajes':
                    cargarMensajes();
                    break;
                case 'reportes':
                    // No necesita carga inicial
                    break;
                case 'config':
                    cargarConfiguracion();
                    break;
            }
        }

        function cerrarPagina(paginaId) {
            document.getElementById(`pagina-${paginaId}`).style.display = 'none';
        }

        // ===== PREVENCIÃN DE CIERRE =====
        function activarPrevencionCierre() {
            prevencionCierreActiva = true;
            document.getElementById('estado-prevencion').textContent = 'Estado: Activo';
            
            // Evento para prevenir el cierre con el botÃ³n de retroceso
            window.history.pushState(null, null, window.location.href);
            window.addEventListener('popstate', function() {
                window.history.pushState(null, null, window.location.href);
                alert('La prevenciÃ³n de cierre estÃ¡ activada. Use el botÃ³n de cerrar en la aplicaciÃ³n.');
            });
            
            // Evento para prevenir el cierre/recarga con F5 o Ctrl+R
            window.addEventListener('beforeunload', function(e) {
                if (prevencionCierreActiva) {
                    e.preventDefault();
                    e.returnValue = '';
                    return '';
                }
            });
            
            alert('PrevenciÃ³n de cierre activada. La aplicaciÃ³n no se cerrarÃ¡ accidentalmente.');
        }

        function desactivarPrevencionCierre() {
            prevencionCierreActiva = false;
            document.getElementById('estado-prevencion').textContent = 'Estado: Inactivo';
            alert('PrevenciÃ³n de cierre desactivada.');
        }

        // ===== FUNCIONES PARA MODALES =====
        function mostrarModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function cerrarModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ===== BÃSQUEDA GLOBAL =====
        function configurarBuscadorGlobal() {
            const buscador = document.getElementById('buscador-global');
            const resultados = document.getElementById('resultados-busqueda');
            
            buscador.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    resultados.style.display = 'none';
                    return;
                }
                
                // Buscar en todos los mÃ³dulos
                const resultadosInventario = buscarEnInventario(query);
                const resultadosClientes = buscarEnClientes(query);
                const resultadosProveedores = buscarEnProveedores(query);
                
                const todosResultados = [
                    ...resultadosInventario.map(item => ({...item, tipo: 'producto'})),
                    ...resultadosClientes.map(item => ({...item, tipo: 'cliente'})),
                    ...resultadosProveedores.map(item => ({...item, tipo: 'proveedor'}))
                ];
                
                mostrarResultadosBusquedaGlobal(todosResultados, resultados);
            });
        }

        function configurarBuscadoresModulos() {
            // Configurar buscador de clientes
            const buscadorClientes = document.getElementById('buscador-clientes');
            const resultadosClientes = document.getElementById('resultados-clientes');
            
            buscadorClientes.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnClientes, resultadosClientes, 'clientes');
            });
            
            // Configurar buscador de cliente en ventas
            const buscadorClienteVenta = document.getElementById('buscador-cliente-venta');
            const resultadosClienteVenta = document.getElementById('resultados-cliente-venta');
            
            buscadorClienteVenta.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnClientes, resultadosClienteVenta, 'cliente-venta');
            });
            
            // Configurar buscador de producto en ventas
            const buscadorProductoVenta = document.getElementById('buscador-producto-venta');
            const resultadosProductoVenta = document.getElementById('resultados-producto-venta');
            
            buscadorProductoVenta.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnInventario, resultadosProductoVenta, 'producto-venta');
            });
            
            // Configurar buscador de inventario
            const buscadorInventario = document.getElementById('buscador-inventario');
            const resultadosInventario = document.getElementById('resultados-inventario');
            
            buscadorInventario.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnInventario, resultadosInventario, 'inventario');
            });
            
            // Configurar buscador de proveedores
            const buscadorProveedores = document.getElementById('buscador-proveedores');
            const resultadosProveedores = document.getElementById('resultados-proveedores');
            
            buscadorProveedores.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnProveedores, resultadosProveedores, 'proveedores');
            });
            
            // Configurar buscador de empleados
            const buscadorEmpleados = document.getElementById('buscador-empleados');
            const resultadosEmpleados = document.getElementById('resultados-empleados');
            
            buscadorEmpleados.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                buscarYMostrarResultados(query, buscarEnEmpleados, resultadosEmpleados, 'empleados');
            });
        }

        function buscarYMostrarResultados(query, funcionBusqueda, contenedorResultados, contexto) {
            if (query.length < 2) {
                contenedorResultados.style.display = 'none';
                return;
            }
            
            const resultados = funcionBusqueda(query);
            mostrarResultadosBusqueda(resultados, contenedorResultados, contexto);
        }

        // ===== FUNCIONES DE BÃSQUEDA =====
        function buscarEnInventario(query) {
            return inventario.filter(item => 
                item.nombre.toLowerCase().includes(query)
            );
        }

        function buscarEnClientes(query) {
            return clientes.filter(item => 
                item.nombre.toLowerCase().includes(query) || 
                (item.email && item.email.toLowerCase().includes(query)) ||
                (item.telefono && item.telefono.includes(query))
            );
        }

        function buscarEnProveedores(query) {
            return proveedores.filter(item => 
                item.nombre.toLowerCase().includes(query) || 
                (item.contacto && item.contacto.toLowerCase().includes(query)) ||
                (item.productos && item.productos.toLowerCase().includes(query))
            );
        }

        function buscarEnEmpleados(query) {
            return empleados.filter(item => 
                item.nombre.toLowerCase().includes(query) || 
                (item.cargo && item.cargo.toLowerCase().includes(query))
            );
        }

        // ===== MOSTRAR RESULTADOS DE BÃSQUEDA =====
        function mostrarResultadosBusquedaGlobal(resultados, contenedor) {
            contenedor.innerHTML = '';
            
            if (resultados.length === 0) {
                contenedor.innerHTML = '<div class="search-result-item">No se encontraron resultados</div>';
                contenedor.style.display = 'block';
                return;
            }
            
            resultados.forEach(item => {
                const elemento = document.createElement('div');
                elemento.className = 'search-result-item';
                
                elemento.innerHTML = `
                    <div>${item.nombre} (${item.tipo})</div>
                    <div class="result-actions">
                        <button class="result-btn btn-add" onclick="venderDesdeBusqueda('${item.tipo}', ${item.id})">Vender</button>
                        <button class="result-btn btn-edit" onclick="editarDesdeBusqueda('${item.tipo}', ${item.id})">Editar</button>
                    </div>
                `;
                
                contenedor.appendChild(elemento);
            });
            
            contenedor.style.display = 'block';
        }

        function mostrarResultadosBusqueda(resultados, contenedor, contexto = 'global') {
            contenedor.innerHTML = '';
            
            if (resultados.length === 0) {
                contenedor.innerHTML = '<div class="search-result-item">No se encontraron resultados</div>';
                contenedor.style.display = 'block';
                return;
            }
            
            resultados.forEach(item => {
                const elemento = document.createElement('div');
                elemento.className = 'search-result-item';
                
                let acciones = '';
                
                if (contexto === 'clientes') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-view" onclick="seleccionarCliente(${item.id})">Seleccionar</button>
                            <button class="result-btn btn-edit" onclick="editarCliente(${item.id})">Editar</button>
                        </div>
                    `;
                } else if (contexto === 'cliente-venta') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-add" onclick="seleccionarCliente(${item.id})">Seleccionar</button>
                        </div>
                    `;
                } else if (contexto === 'producto-venta') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-add" onclick="agregarProductoVenta(${item.id})">Agregar</button>
                        </div>
                    `;
                } else if (contexto === 'inventario') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-sell" onclick="venderProducto(${item.id})">Vender</button>
                            <button class="result-btn btn-edit" onclick="editarProducto(${item.id})">Editar</button>
                        </div>
                    `;
                } else if (contexto === 'proveedores') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-view" onclick="verProveedor(${item.id})">Ver</button>
                            <button class="result-btn btn-edit" onclick="editarProveedor(${item.id})">Editar</button>
                        </div>
                    `;
                } else if (contexto === 'empleados') {
                    acciones = `
                        <div class="result-actions">
                            <button class="result-btn btn-view" onclick="verEmpleado(${item.id})">Ver</button>
                            <button class="result-btn btn-edit" onclick="editarEmpleado(${item.id})">Editar</button>
                        </div>
                    `;
                }
                
                elemento.innerHTML = `
                    <div>${item.nombre}</div>
                    ${acciones}
                `;
                
                contenedor.appendChild(elemento);
            });
            
            contenedor.style.display = 'block';
        }

        // ===== FUNCIONES DESDE BÃSQUEDA =====
        function venderDesdeBusqueda(tipo, id) {
            if (tipo === 'producto') {
                abrirPagina('ventas');
                setTimeout(() => {
                    agregarProductoVenta(id);
                }, 100);
            } else if (tipo === 'cliente') {
                abrirPagina('ventas');
                setTimeout(() => {
                    seleccionarCliente(id);
                }, 100);
            }
            document.getElementById('resultados-busqueda').style.display = 'none';
            document.getElementById('buscador-global').value = '';
        }

        function editarDesdeBusqueda(tipo, id) {
            if (tipo === 'producto') {
                abrirPagina('inventario');
                setTimeout(() => {
                    editarProducto(id);
                }, 100);
            } else if (tipo === 'cliente') {
                abrirPagina('clientes');
                setTimeout(() => {
                    editarCliente(id);
                }, 100);
            } else if (tipo === 'proveedor') {
                abrirPagina('proveedores');
                setTimeout(() => {
                    editarProveedor(id);
                }, 100);
            }
            document.getElementById('resultados-busqueda').style.display = 'none';
            document.getElementById('buscador-global').value = '';
        }

        // ===== FUNCIONES PARA VENTAS =====
        function seleccionarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (cliente) {
                ventaActual.cliente = cliente;
                document.getElementById('buscador-cliente-venta').value = cliente.nombre;
                document.getElementById('resultados-cliente-venta').style.display = 'none';
            }
        }

        function agregarProductoVenta(id) {
            const producto = inventario.find(p => p.id === id);
            if (producto) {
                const existente = ventaActual.productos.find(p => p.id === id);
                
                if (existente) {
                    existente.cantidad += 1;
                } else {
                    ventaActual.productos.push({
                        ...producto,
                        cantidad: 1
                    });
                }
                
                actualizarProductosVenta();
                document.getElementById('buscador-producto-venta').value = '';
                document.getElementById('resultados-producto-venta').style.display = 'none';
            }
        }

        function actualizarProductosVenta() {
            const contenedor = document.getElementById('productos-seleccionados');
            contenedor.innerHTML = '';
            
            ventaActual.productos.forEach(producto => {
                const elemento = document.createElement('div');
                elemento.className = 'producto-venta';
                
                const subtotalBs = producto.precioBs * producto.cantidad;
                
                elemento.innerHTML = `
                    <div class="producto-info">
                        <strong>${producto.nombre}</strong>
                        <div>Cantidad: ${producto.cantidad}</div>
                        <div>Precio: ${producto.precioBs.toFixed(2)} Bs</div>
                        <div>Subtotal: ${subtotalBs.toFixed(2)} Bs</div>
                    </div>
                    <div class="producto-acciones">
                        <button class="btn btn-primary" onclick="modificarCantidad(${producto.id}, 1)">+</button>
                        <button class="btn btn-warning" onclick="modificarCantidad(${producto.id}, -1)">-</button>
                        <button class="btn btn-danger" onclick="eliminarProductoVenta(${producto.id})">X</button>
                    </div>
                `;
                
                contenedor.appendChild(elemento);
            });
            
            calcularTotalVenta();
        }

        function modificarCantidad(id, cambio) {
            const producto = ventaActual.productos.find(p => p.id === id);
            if (producto) {
                producto.cantidad += cambio;
                
                if (producto.cantidad <= 0) {
                    eliminarProductoVenta(id);
                } else {
                    actualizarProductosVenta();
                }
            }
        }

        function eliminarProductoVenta(id) {
            ventaActual.productos = ventaActual.productos.filter(p => p.id !== id);
            actualizarProductosVenta();
        }

        function calcularTotalVenta() {
            let subtotalBs = 0;
            
            ventaActual.productos.forEach(producto => {
                subtotalBs += producto.precioBs * producto.cantidad;
            });
            
            ventaActual.totalBs = subtotalBs;
            
            document.getElementById('total-bs').textContent = subtotalBs.toFixed(2);
        }

        function finalizarVenta() {
            if (ventaActual.productos.length === 0) {
                alert('Debe agregar al menos un producto a la venta');
                return;
            }
            
            // Verificar stock suficiente
            for (const productoVenta of ventaActual.productos) {
                const productoInventario = inventario.find(p => p.id === productoVenta.id);
                if (productoInventario && productoInventario.stock < productoVenta.cantidad) {
                    alert(`No hay suficiente stock de ${productoInventario.nombre}. Stock disponible: ${productoInventario.stock}`);
                    return;
                }
            }
            
            // Actualizar stock
            ventaActual.productos.forEach(productoVenta => {
                const productoInventario = inventario.find(p => p.id === productoVenta.id);
                if (productoInventario) {
                    productoInventario.stock -= productoVenta.cantidad;
                }
            });
            
            localStorage.setItem('inventario', JSON.stringify(inventario));
            
            // Registrar la venta en el historial
            const ventas = JSON.parse(localStorage.getItem('ventas')) || [];
            ventas.push({
                id: Date.now(),
                fecha: new Date().toISOString(),
                cliente: ventaActual.cliente,
                productos: ventaActual.productos,
                totalBs: ventaActual.totalBs
            });
            localStorage.setItem('ventas', JSON.stringify(ventas));
            
            alert('Venta registrada con Ã©xito');
            reiniciarVenta();
        }

        function reiniciarVenta() {
            ventaActual = {
                cliente: null,
                productos: [],
                totalBs: 0
            };
            
            document.getElementById('buscador-cliente-venta').value = '';
            document.getElementById('buscador-producto-venta').value = '';
            document.getElementById('productos-seleccionados').innerHTML = '';
            calcularTotalVenta();
        }

        function mostrarFactura() {
            if (ventaActual.productos.length === 0) {
                alert('No hay productos en la venta');
                return;
            }
            
            // Actualizar informaciÃ³n de la factura
            document.getElementById('factura-fecha').textContent = new Date().toLocaleDateString();
            document.getElementById('factura-cliente-nombre').textContent = ventaActual.cliente ? ventaActual.cliente.nombre : 'Cliente General';
            
            // Actualizar informaciÃ³n de la empresa desde configuraciÃ³n
            document.getElementById('nombre-empresa-factura').textContent = configuracion.empresa.nombre;
            document.getElementById('rif-empresa-factura').textContent = configuracion.empresa.rif;
            document.getElementById('telefono-empresa-factura').textContent = configuracion.empresa.telefono;
            
            const facturaItemsBody = document.getElementById('factura-items-body');
            facturaItemsBody.innerHTML = '';
            
            ventaActual.productos.forEach(producto => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>${producto.cantidad}</td>
                    <td>${producto.precioBs.toFixed(2)}</td>
                    <td>${(producto.precioBs * producto.cantidad).toFixed(2)}</td>
                `;
                facturaItemsBody.appendChild(row);
            });
            
            document.getElementById('factura-total').textContent = ventaActual.totalBs.toFixed(2);
            
            mostrarModal('modal-factura');
        }

        // ===== FUNCIONES PARA INVENTARIO =====
        function cargarInventario() {
            const tbody = document.querySelector("#tabla-inventario tbody");
            if (!tbody) return;
            
            tbody.innerHTML = "";
            inventario.forEach((producto) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>$${producto.precioUSD.toFixed(2)}</td>
                    <td>${producto.precioBs.toFixed(2)} Bs</td>
                    <td>${producto.stock}</td>
                    <td>
                        <div class="acciones-tabla">
                            <button class="btn btn-sell" onclick="venderProducto(${producto.id})">Vender</button>
                            <button class="btn btn-primary" onclick="editarProducto(${producto.id})">Editar</button>
                            <button class="btn btn-danger" onclick="eliminarProducto(${producto.id})">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function venderProducto(id) {
            const producto = inventario.find(p => p.id === id);
            if (producto) {
                abrirPagina('ventas');
                setTimeout(() => {
                    agregarProductoVenta(id);
                }, 100);
            }
        }

        function calcularPrecioBs() {
            const precioUSD = parseFloat(document.getElementById('precio-usd-producto').value) || 0;
            const precioBs = precioUSD * tipoCambio;
            document.getElementById('precio-bs-producto').value = precioBs.toFixed(2);
        }

        function guardarNuevoProducto() {
            const nombre = document.getElementById('nombre-producto').value;
            const precioUSD = parseFloat(document.getElementById('precio-usd-producto').value) || 0;
            const stock = parseInt(document.getElementById('stock-producto').value) || 0;
            
            // Validar que tenga nombre
            if (!nombre || nombre.trim() === '') {
                alert('Por favor ingrese un nombre para el producto');
                return;
            }
            
            const nuevoProducto = {
                id: Date.now(),
                nombre: nombre.trim(),
                precioUSD: precioUSD,
                precioBs: precioUSD * tipoCambio,
                stock: stock
            };
            
            inventario.push(nuevoProducto);
            localStorage.setItem('inventario', JSON.stringify(inventario));
            cargarInventario();
            cerrarModal('modal-agregar-producto');
            
            // Limpiar formulario
            document.getElementById('form-agregar-producto').reset();
        }

        function editarProducto(id) {
            const producto = inventario.find(p => p.id === id);
            if (!producto) return;
            
            document.getElementById('nombre-producto').value = producto.nombre;
            document.getElementById('precio-usd-producto').value = producto.precioUSD;
            document.getElementById('precio-bs-producto').value = producto.precioBs;
            document.getElementById('stock-producto').value = producto.stock;
            document.getElementById('titulo-modal-producto').textContent = 'Editar Producto';
            
            mostrarModal('modal-agregar-producto');
            
            // Configurar el formulario para actualizar en lugar de crear
            const form = document.getElementById('form-agregar-producto');
            form.onsubmit = function(e) {
                e.preventDefault();
                actualizarProducto(id);
            };
        }

        function actualizarProducto(id) {
            const index = inventario.findIndex(p => p.id === id);
            if (index === -1) return;
            
            const nombre = document.getElementById('nombre-producto').value;
            const precioUSD = parseFloat(document.getElementById('precio-usd-producto').value) || 0;
            const stock = parseInt(document.getElementById('stock-producto').value) || 0;
            
            inventario[index] = {
                id: id,
                nombre: nombre || 'Producto sin nombre',
                precioUSD: precioUSD,
                precioBs: precioUSD * tipoCambio,
                stock: stock
            };
            
            localStorage.setItem('inventario', JSON.stringify(inventario));
            cargarInventario();
            cerrarModal('modal-agregar-producto');
            
            // Restaurar el formulario para crear nuevos productos
            const form = document.getElementById('form-agregar-producto');
            form.onsubmit = function(e) {
                e.preventDefault();
                guardarNuevoProducto();
            };
            document.getElementById('titulo-modal-producto').textContent = 'Agregar Producto';
            form.reset(); // Esto es importante para limpiar todos los campos
        }

        function eliminarProducto(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este producto?")) {
                inventario = inventario.filter(p => p.id !== id);
                localStorage.setItem('inventario', JSON.stringify(inventario));
                cargarInventario();
            }
        }

        // ===== FUNCIONES PARA CLIENTES =====
        function cargarClientes() {
            const tbody = document.querySelector("#tabla-clientes tbody");
            if (!tbody) return;
            
            tbody.innerHTML = "";
            clientes.forEach((cliente) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${cliente.nombre}</td>
                    <td>${cliente.telefono || '-'}</td>
                    <td>${cliente.email || '-'}</td>
                    <td>
                        <div class="acciones-tabla">
                            <button class="btn btn-primary" onclick="editarCliente(${cliente.id})">Editar</button>
                            <button class="btn btn-danger" onclick="eliminarCliente(${cliente.id})">Eliminar</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function guardarNuevoClienteDesdeModal() {
            const nombre = document.getElementById('nombre-cliente-modal').value;
            const telefono = document.getElementById('telefono-cliente-modal').value;
            const email = document.getElementById('email-cliente-modal').value;
            const direccion = document.getElementById('direccion-cliente-modal').value;
            
            const nuevoCliente = {
                id: Date.now(),
                nombre: nombre || 'Cliente sin nombre',
                telefono: telefono,
                email: email,
                direccion: direccion
            };
            
            clientes.push(nuevoCliente);
            localStorage.setItem('clientes', JSON.stringify(clientes));
            
            // Si estamos en la pÃ¡gina de ventas, seleccionar el nuevo cliente
            if (document.getElementById('pagina-ventas').style.display === 'block') {
                seleccionarCliente(nuevoCliente.id);
                document.getElementById('buscador-cliente-venta').value = nuevoCliente.nombre;
            }
            
            cerrarModal('modal-nuevo-cliente');
            document.getElementById('form-nuevo-cliente').reset();
        }

        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;
            
            document.getElementById('nombre-cliente-modal').value = cliente.nombre;
            document.getElementById('telefono-cliente-modal').value = cliente.telefono || '';
            document.getElementById('email-cliente-modal').value = cliente.email || '';
            document.getElementById('direccion-cliente-modal').value = cliente.direccion || '';
            
            mostrarModal('modal-nuevo-cliente');
            
            // Configurar el formulario para actualizar en lugar de crear
            const form = document.getElementById('form-nuevo-cliente');
            form.onsubmit = function(e) {
                e.preventDefault();
                actualizarCliente(id);
            };
        }

        function actualizarCliente(id) {
            const index = clientes.findIndex(c => c.id === id);
            if (index === -1) return;
            
            const nombre = document.getElementById('nombre-cliente-modal').value;
            const telefono = document.getElementById('telefono-cliente-modal').value;
            const email = document.getElementById('email-cliente-modal').value;
            const direccion = document.getElementById('direccion-cliente-modal').value;
            
            clientes[index] = {
                id: id,
                nombre: nombre || 'Cliente sin nombre',
                telefono: telefono,
                email: email,
                direccion: direccion
            };
            
            localStorage.setItem('clientes', JSON.stringify(clientes));
            cargarClientes();
            cerrarModal('modal-nuevo-cliente');
            
            // Restaurar el formulario para crear nuevos clientes
            const form = document.getElementById('form-nuevo-cliente');
            form.onsubmit = function(e) {
                e.preventDefault();
                guardarNuevoClienteDesdeModal();
            };
            form.reset();
        }

        function eliminarCliente(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este cliente?")) {
                clientes = clientes.filter(c => c.id !== id);
                localStorage.setItem('clientes', JSON.stringify(clientes));
                cargarClientes();
            }
        }

        // ===== FUNCIONES PARA PROVEEDORES =====
        function cargarProveedores() {
            const contenedor = document.getElementById('lista-proveedores');
            if (!contenedor) return;
            
            contenedor.innerHTML = '';
            proveedores.forEach(proveedor => {
                const elemento = document.createElement('div');
                elemento.className = 'proveedor-item card';
                elemento.innerHTML = `
                    <h3>${proveedor.nombre}</h3>
                    <p><strong>Contacto:</strong> ${proveedor.contacto || 'No especificado'}</p>
                    <p><strong>TelÃ©fono:</strong> ${proveedor.telefono || 'No especificado'}</p>
                    <p><strong>Email:</strong> ${proveedor.email || 'No especificado'}</p>
                    <p><strong>Productos:</strong> ${proveedor.productos || 'No especificado'}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="editarProveedor(${proveedor.id})">Editar</button>
                        <button class="btn btn-danger" onclick="eliminarProveedor(${proveedor.id})">Eliminar</button>
                    </div>
                `;
                contenedor.appendChild(elemento);
            });
        }

        function guardarNuevoProveedor() {
            const nombre = document.getElementById('nombre-proveedor').value;
            const contacto = document.getElementById('contacto-proveedor').value;
            const telefono = document.getElementById('telefono-proveedor').value;
            const email = document.getElementById('email-proveedor').value;
            const productos = document.getElementById('productos-proveedor').value;
            
            const nuevoProveedor = {
                id: Date.now(),
                nombre: nombre || 'Proveedor sin nombre',
                contacto: contacto,
                telefono: telefono,
                email: email,
                productos: productos
            };
            
            proveedores.push(nuevoProveedor);
            localStorage.setItem('proveedores', JSON.stringify(proveedores));
            cargarProveedores();
            cerrarModal('modal-agregar-proveedor');
            
            document.getElementById('form-agregar-proveedor').reset();
        }

        function editarProveedor(id) {
            const proveedor = proveedores.find(p => p.id === id);
            if (!proveedor) return;
            
            document.getElementById('nombre-proveedor').value = proveedor.nombre;
            document.getElementById('contacto-proveedor').value = proveedor.contacto || '';
            document.getElementById('telefono-proveedor').value = proveedor.telefono || '';
            document.getElementById('email-proveedor').value = proveedor.email || '';
            document.getElementById('productos-proveedor').value = proveedor.productos || '';
            
            mostrarModal('modal-agregar-proveedor');
            
            // Configurar el formulario para actualizar en lugar de crear
            const form = document.getElementById('form-agregar-proveedor');
            form.onsubmit = function(e) {
                e.preventDefault();
                actualizarProveedor(id);
            };
        }

        function actualizarProveedor(id) {
            const index = proveedores.findIndex(p => p.id === id);
            if (index === -1) return;
            
            const nombre = document.getElementById('nombre-proveedor').value;
            const contacto = document.getElementById('contacto-proveedor').value;
            const telefono = document.getElementById('telefono-proveedor').value;
            const email = document.getElementById('email-proveedor').value;
            const productos = document.getElementById('productos-proveedor').value;
            
            proveedores[index] = {
                id: id,
                nombre: nombre || 'Proveedor sin nombre',
                contacto: contacto,
                telefono: telefono,
                email: email,
                productos: productos
            };
            
            localStorage.setItem('proveedores', JSON.stringify(proveedores));
            cargarProveedores();
            cerrarModal('modal-agregar-proveedor');
            
            // Restaurar el formulario para crear nuevos proveedores
            const form = document.getElementById('form-agregar-proveedor');
            form.onsubmit = function(e) {
                e.preventDefault();
                guardarNuevoProveedor();
            };
            form.reset();
        }

        function eliminarProveedor(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este proveedor?")) {
                proveedores = proveedores.filter(p => p.id !== id);
                localStorage.setItem('proveedores', JSON.stringify(proveedores));
                cargarProveedores();
            }
        }

        function verProveedor(id) {
            const proveedor = proveedores.find(p => p.id === id);
            if (proveedor) {
                alert(`InformaciÃ³n de ${proveedor.nombre}\nContacto: ${proveedor.contacto}\nTelÃ©fono: ${proveedor.telefono}\nEmail: ${proveedor.email}\nProductos: ${proveedor.productos}`);
            }
        }

        // ===== FUNCIONES PARA GASTOS =====
        function cargarGastos() {
            const contenedor = document.getElementById('lista-gastos');
            if (!contenedor) return;
            
            // Filtrar gastos por mes seleccionado
            const filtroMes = document.getElementById('filtro-fecha-gastos').value;
            const gastosFiltrados = gastos.filter(gasto => {
                return gasto.fecha.startsWith(filtroMes);
            });
            
            contenedor.innerHTML = '';
            gastosFiltrados.forEach(gasto => {
                const elemento = document.createElement('div');
                elemento.className = 'gasto-item card';
                elemento.innerHTML = `
                    <h3>${gasto.descripcion}</h3>
                    <p><strong>CategorÃ­a:</strong> ${gasto.categoria}</p>
                    <p><strong>Monto:</strong> ${gasto.monto.toFixed(2)} Bs</p>
                    <p><strong>Fecha:</strong> ${new Date(gasto.fecha).toLocaleDateString()}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="editarGasto(${gasto.id})">Editar</button>
                        <button class="btn btn-danger" onclick="eliminarGasto(${gasto.id})">Eliminar</button>
                    </div>
                `;
                contenedor.appendChild(elemento);
            });
            
            // Actualizar resumen
            actualizarResumenGastos(gastosFiltrados);
        }

        function filtrarGastos() {
            cargarGastos();
        }

        function actualizarResumenGastos(gastosFiltrados) {
            const total = gastosFiltrados.reduce((sum, gasto) => sum + gasto.monto, 0);
            document.getElementById('total-gastos').textContent = total.toFixed(2);
            
            // Calcular por categorÃ­as
            const categorias = {};
            gastosFiltrados.forEach(gasto => {
                if (!categorias[gasto.categoria]) {
                    categorias[gasto.categoria] = 0;
                }
                categorias[gasto.categoria] += gasto.monto;
            });
            
            const listaCategorias = document.getElementById('categorias-gastos');
            listaCategorias.innerHTML = '';
            
            for (const categoria in categorias) {
                const item = document.createElement('li');
                item.textContent = `${categoria}: ${categorias[categoria].toFixed(2)} Bs`;
                listaCategorias.appendChild(item);
            }
        }

        function guardarNuevoGasto() {
            const descripcion = document.getElementById('descripcion-gasto').value;
            const categoria = document.getElementById('categoria-gasto').value;
            const monto = parseFloat(document.getElementById('monto-gasto').value) || 0;
            const fecha = document.getElementById('fecha-gasto').value;
            
            const nuevoGasto = {
                id: Date.now(),
                descripcion: descripcion || 'Gasto sin descripciÃ³n',
                categoria: categoria,
                monto: monto,
                fecha: fecha
            };
            
            gastos.push(nuevoGasto);
            localStorage.setItem('gastos', JSON.stringify(gastos));
            cargarGastos();
            cerrarModal('modal-agregar-gasto');
            
            document.getElementById('form-agregar-gasto').reset();
            document.getElementById('fecha-gasto').value = new Date().toISOString().split('T')[0];
        }

        function editarGasto(id) {
            const gasto = gastos.find(g => g.id === id);
            if (!gasto) return;
            
            document.getElementById('descripcion-gasto').value = gasto.descripcion;
            document.getElementById('categoria-gasto').value = gasto.categoria;
            document.getElementById('monto-gasto').value = gasto.monto;
            document.getElementById('fecha-gasto').value = gasto.fecha;
            
            mostrarModal('modal-agregar-gasto');
            
            // Configurar el formulario para actualizar en lugar de crear
            const form = document.getElementById('form-agregar-gasto');
            form.onsubmit = function(e) {
                e.preventDefault();
                actualizarGasto(id);
            };
        }

        function actualizarGasto(id) {
            const index = gastos.findIndex(g => g.id === id);
            if (index === -1) return;
            
            const descripcion = document.getElementById('descripcion-gasto').value;
            const categoria = document.getElementById('categoria-gasto').value;
            const monto = parseFloat(document.getElementById('monto-gasto').value) || 0;
            const fecha = document.getElementById('fecha-gasto').value;
            
            gastos[index] = {
                id: id,
                descripcion: descripcion || 'Gasto sin descripciÃ³n',
                categoria: categoria,
                monto: monto,
                fecha: fecha
            };
            
            localStorage.setItem('gastos', JSON.stringify(gastos));
            cargarGastos();
            cerrarModal('modal-agregar-gasto');
            
            // Restaurar el formulario para crear nuevos gastos
            const form = document.getElementById('form-agregar-gasto');
            form.onsubmit = function(e) {
                e.preventDefault();
                guardarNuevoGasto();
            };
            form.reset();
            document.getElementById('fecha-gasto').value = new Date().toISOString().split('T')[0];
        }

        function eliminarGasto(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este gasto?")) {
                gastos = gastos.filter(g => g.id !== id);
                localStorage.setItem('gastos', JSON.stringify(gastos));
                cargarGastos();
            }
        }

        // ===== FUNCIONES PARA EMPLEADOS =====
        function cargarEmpleados() {
            const contenedor = document.getElementById('lista-empleados');
            if (!contenedor) return;
            
            contenedor.innerHTML = '';
            empleados.forEach(empleado => {
                const elemento = document.createElement('div');
                elemento.className = 'empleado-item card';
                elemento.innerHTML = `
                    <h3>${empleado.nombre}</h3>
                    <p><strong>Cargo:</strong> ${empleado.cargo || 'No especificado'}</p>
                    <p><strong>Salario:</strong> ${empleado.salario ? empleado.salario.toFixed(2) + ' Bs' : 'No especificado'}</p>
                    <p><strong>TelÃ©fono:</strong> ${empleado.telefono || 'No especificado'}</p>
                    <p><strong>Fecha de Contrato:</strong> ${empleado.fechaContrato ? new Date(empleado.fechaContrato).toLocaleDateString() : 'No especificada'}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="editarEmpleado(${empleado.id})">Editar</button>
                        <button class="btn btn-danger" onclick="eliminarEmpleado(${empleado.id})">Eliminar</button>
                    </div>
                `;
                contenedor.appendChild(elemento);
            });
        }

        function guardarNuevoEmpleado() {
            const nombre = document.getElementById('nombre-empleado').value;
            const cargo = document.getElementById('cargo-empleado').value;
            const salario = parseFloat(document.getElementById('salario-empleado').value) || 0;
            const telefono = document.getElementById('telefono-empleado').value;
            const fechaContrato = document.getElementById('fecha-contracto').value;
            
            const nuevoEmpleado = {
                id: Date.now(),
                nombre: nombre || 'Empleado sin nombre',
                cargo: cargo,
                salario: salario,
                telefono: telefono,
                fechaContrato: fechaContrato
            };
            
            empleados.push(nuevoEmpleado);
            localStorage.setItem('empleados', JSON.stringify(empleados));
            cargarEmpleados();
            cerrarModal('modal-agregar-empleado');
            
            document.getElementById('form-agregar-empleado').reset();
            document.getElementById('fecha-contracto').value = new Date().toISOString().split('T')[0];
        }

        function editarEmpleado(id) {
            const empleado = empleados.find(e => e.id === id);
            if (!empleado) return;
            
            document.getElementById('nombre-empleado').value = empleado.nombre;
            document.getElementById('cargo-empleado').value = empleado.cargo || '';
            document.getElementById('salario-empleado').value = empleado.salario || '';
            document.getElementById('telefono-empleado').value = empleado.telefono || '';
            document.getElementById('fecha-contracto').value = empleado.fechaContrato || '';
            
            mostrarModal('modal-agregar-empleado');
            
            // Configurar el formulario para actualizar en lugar de crear
            const form = document.getElementById('form-agregar-empleado');
            form.onsubmit = function(e) {
                e.preventDefault();
                actualizarEmpleado(id);
            };
        }

        function actualizarEmpleado(id) {
            const index = empleados.findIndex(e => e.id === id);
            if (index === -1) return;
            
            const nombre = document.getElementById('nombre-empleado').value;
            const cargo = document.getElementById('cargo-empleado').value;
            const salario = parseFloat(document.getElementById('salario-empleado').value) || 0;
            const telefono = document.getElementById('telefono-empleado').value;
            const fechaContrato = document.getElementById('fecha-contracto').value;
            
            empleados[index] = {
                id: id,
                nombre: nombre || 'Empleado sin nombre',
                cargo: cargo,
                salario: salario,
                telefono: telefono,
                fechaContrato: fechaContrato
            };
            
            localStorage.setItem('empleados', JSON.stringify(empleados));
            cargarEmpleados();
            cerrarModal('modal-agregar-empleado');
            
            // Restaurar el formulario para crear nuevos empleados
            const form = document.getElementById('form-agregar-empleado');
            form.onsubmit = function(e) {
                e.preventDefault();
                guardarNuevoEmpleado();
            };
            form.reset();
            document.getElementById('fecha-contracto').value = new Date().toISOString().split('T')[0];
        }

        function eliminarEmpleado(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este empleado?")) {
                empleados = empleados.filter(e => e.id !== id);
                localStorage.setItem('empleados', JSON.stringify(empleados));
                cargarEmpleados();
            }
        }

        function verEmpleado(id) {
            const empleado = empleados.find(e => e.id === id);
            if (empleado) {
                alert(`InformaciÃ³n de ${empleado.nombre}\nCargo: ${empleado.cargo}\nSalario: ${empleado.salario} Bs\nTelÃ©fono: ${empleado.telefono}\nFecha de Contrato: ${new Date(empleado.fechaContrato).toLocaleDateString()}`);
            }
        }

        // ===== FUNCIONES PARA TIPO DE CAMBIO =====
        function actualizarTipoCambioVisual() {
            const tipoCambioBtn = document.getElementById('tipo-cambio-btn');
            const tipoCambioVenta = document.getElementById('tipo-cambio-venta');
            const tipoCambioActual = document.getElementById('tipo-cambio-actual');
            
            if (tipoCambioBtn) tipoCambioBtn.textContent = `1$ = ${tipoCambio.toFixed(2)} Bs`;
            if (tipoCambioVenta) tipoCambioVenta.textContent = `1$ = ${tipoCambio.toFixed(2)} Bs`;
            if (tipoCambioActual) tipoCambioActual.textContent = tipoCambio.toFixed(2);
        }

        function cargarHistorialTipoCambio() {
            const contenedor = document.getElementById('historial-tipo-cambio');
            if (!contenedor) return;
            
            // Mostrar Ãºltima actualizaciÃ³n
            const ultimaActualizacion = historialTipoCambio[historialTipoCambio.length - 1];
            if (ultimaActualizacion) {
                document.getElementById('fecha-actualizacion').textContent = new Date(ultimaActualizacion.fecha).toLocaleDateString();
            }
            
            // Mostrar historial
            contenedor.innerHTML = '';
            historialTipoCambio.slice().reverse().forEach(item => {
                const elemento = document.createElement('div');
                elemento.innerHTML = `
                    <p>${new Date(item.fecha).toLocaleDateString()}: 1$ = ${item.tasa.toFixed(2)} Bs</p>
                `;
                contenedor.appendChild(elemento);
            });
        }

        function actualizarTipoCambio() {
            const nuevoTipoCambio = parseFloat(document.getElementById('nuevo-tipo-cambio').value);
            
            if (isNaN(nuevoTipoCambio) || nuevoTipoCambio <= 0) {
                alert('Por favor ingrese un valor vÃ¡lido para el tipo de cambio');
                return;
            }
            
            tipoCambio = nuevoTipoCambio;
            historialTipoCambio.push({
                fecha: new Date().toISOString(),
                tasa: tipoCambio
            });
            
            localStorage.setItem('tipoCambio', tipoCambio);
            localStorage.setItem('historialTipoCambio', JSON.stringify(historialTipoCambio));
            
            // Actualizar precios en BS de todos los productos
            inventario.forEach(producto => {
                producto.precioBs = producto.precioUSD * tipoCambio;
            });
            localStorage.setItem('inventario', JSON.stringify(inventario));
            
            actualizarTipoCambioVisual();
            cargarHistorialTipoCambio();
            
            alert('Tipo de cambio actualizado correctamente');
        }

        // ===== FUNCIONES PARA MENSAJES =====
        function cargarMensajes() {
            const contenedor = document.getElementById('lista-mensajes');
            if (!contenedor) return;
            
            contenedor.innerHTML = '';
            mensajes.forEach(mensaje => {
                const elemento = document.createElement('div');
                elemento.className = `mensaje-item card ${mensaje.leido ? '' : 'unread'}`;
                elemento.innerHTML = `
                    <h3>${mensaje.asunto} ${mensaje.importante ? 'â­' : ''}</h3>
                    <p><strong>De:</strong> ${mensaje.remitente}</p>
                    <p><strong>Fecha:</strong> ${new Date(mensaje.fecha).toLocaleDateString()}</p>
                    <p>${mensaje.contenido.substring(0, 100)}${mensaje.contenido.length > 100 ? '...' : ''}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="verMensaje(${mensaje.id})">Leer</button>
                        <button class="btn" onclick="marcarComoLeido(${mensaje.id})">${mensaje.leido ? 'Marcar como no leÃ­do' : 'Marcar como leÃ­do'}</button>
                        ${mensaje.importante ? 
                            '<button class="btn" onclick="quitarImportante(${mensaje.id})">Quitar importante</button>' : 
                            '<button class="btn" onclick="marcarImportante(${mensaje.id})">Marcar importante</button>'
                        }
                        <button class="btn btn-danger" onclick="eliminarMensaje(${mensaje.id})">Eliminar</button>
                    </div>
                `;
                contenedor.appendChild(elemento);
            });
        }

        function filtrarMensajes(filtro) {
            // Esta funciÃ³n se puede expandir para implementar filtros reales
            alert(`Filtrando mensajes por: ${filtro}`);
            // En una implementaciÃ³n real, aquÃ­ se filtrarÃ­a la lista de mensajes
        }

        function verMensaje(id) {
            const mensaje = mensajes.find(m => m.id === id);
            if (mensaje) {
                // Marcar como leÃ­do
                if (!mensaje.leido) {
                    mensaje.leido = true;
                    localStorage.setItem('mensajes', JSON.stringify(mensajes));
                }
                
                alert(`ASUNTO: ${mensaje.asunto}\nDE: ${mensaje.remitente}\nFECHA: ${new Date(mensaje.fecha).toLocaleDateString()}\n\n${mensaje.contenido}`);
                cargarMensajes();
            }
        }

        function marcarComoLeido(id) {
            const mensaje = mensajes.find(m => m.id === id);
            if (mensaje) {
                mensaje.leido = !mensaje.leido;
                localStorage.setItem('mensajes', JSON.stringify(mensajes));
                cargarMensajes();
            }
        }

        function marcarImportante(id) {
            const mensaje = mensajes.find(m => m.id === id);
            if (mensaje) {
                mensaje.importante = true;
                localStorage.setItem('mensajes', JSON.stringify(mensajes));
                cargarMensajes();
            }
        }

        function quitarImportante(id) {
            const mensaje = mensajes.find(m => m.id === id);
            if (mensaje) {
                mensaje.importante = false;
                localStorage.setItem('mensajes', JSON.stringify(mensajes));
                cargarMensajes();
            }
        }

        function eliminarMensaje(id) {
            if (confirm("Â¿EstÃ¡ seguro de eliminar este mensaje?")) {
                mensajes = mensajes.filter(m => m.id !== id);
                localStorage.setItem('mensajes', JSON.stringify(mensajes));
                cargarMensajes();
            }
        }

        // ===== FUNCIONES PARA REPORTES =====
        function generarReporte() {
            const tipoReporte = document.getElementById('tipo-reporte').value;
            const fechaInicio = document.getElementById('fecha-inicio').value;
            const fechaFin = document.getElementById('fecha-fin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor seleccione un rango de fechas');
                return;
            }
            
            const contenedor = document.getElementById('contenedor-reporte');
            contenedor.innerHTML = '<h3>Generando reporte...</h3>';
            
            // Simular generaciÃ³n de reporte
            setTimeout(() => {
                let contenidoReporte = '';
                
                switch(tipoReporte) {
                    case 'ventas':
                        const ventas = JSON.parse(localStorage.getItem('ventas')) || [];
                        const ventasFiltradas = ventas.filter(venta => {
                            return venta.fecha >= fechaInicio && venta.fecha <= fechaFin;
                        });
                        
                        contenidoReporte = `
                            <h3>Reporte de Ventas (${fechaInicio} a ${fechaFin})</h3>
                            <p>Total de ventas: ${ventasFiltradas.length}</p>
                            <p>Total en Bs: ${ventasFiltradas.reduce((sum, venta) => sum + venta.totalBs, 0).toFixed(2)} Bs</p>
                        `;
                        break;
                        
                    case 'inventario':
                        contenidoReporte = `
                            <h3>Reporte de Inventario</h3>
                            <p>Total de productos: ${inventario.length}</p>
                            <p>Valor total en Bs: ${inventario.reduce((sum, producto) => sum + (producto.precioBs * producto.stock), 0).toFixed(2)} Bs</p>
                        `;
                        break;
                        
                    case 'gastos':
                        const gastosFiltrados = gastos.filter(gasto => {
                            return gasto.fecha >= fechaInicio && gasto.fecha <= fechaFin;
                        });
                        
                        contenidoReporte = `
                            <h3>Reporte de Gastos (${fechaInicio} to ${fechaFin})</h3>
                            <p>Total de gastos: ${gastosFiltrados.length}</p>
                            <p>Total gastado: ${gastosFiltrados.reduce((sum, gasto) => sum + gasto.monto, 0).toFixed(2)} Bs</p>
                        `;
                        break;
                        
                    case 'clientes':
                        contenidoReporte = `
                            <h3>Reporte de Clientes</h3>
                            <p>Total de clientes: ${clientes.length}</p>
                        `;
                        break;
                }
                
                contenedor.innerHTML = contenidoReporte + `
                    <button class="btn btn-primary" onclick="exportarReporte()">Exportar Reporte</button>
                `;
            }, 1000);
        }

        function exportarReporte() {
            alert('Funcionalidad de exportaciÃ³n en desarrollo. En una versiÃ³n completa, esto generarÃ­a un PDF o Excel.');
        }

        // ===== FUNCIONES PARA CONFIGURACIÃN =====
        function cargarConfiguracion() {
            document.getElementById('nombre-empresa').value = configuracion.empresa.nombre;
            document.getElementById('rif-empresa').value = configuracion.empresa.rif;
            document.getElementById('telefono-empresa').value = configuracion.empresa.telefono;
            document.getElementById('direccion-empresa').value = configuracion.empresa.direccion;
            
            // Configurar botÃ³n de tema
            const btnTema = document.getElementById('btn-cambiar-tema');
            if (btnTema) {
                btnTema.textContent = configuracion.tema === 'claro' ? 'Cambiar a Modo Oscuro' : 'Cambiar a Modo Claro';
            }
            
            // Aplicar tema
            if (configuracion.tema === 'oscuro') {
                document.body.classList.add('tema-oscuro');
            } else {
                document.body.classList.remove('tema-oscuro');
            }
        }

        function cambiarTema() {
            if (configuracion.tema === 'claro') {
                configuracion.tema = 'oscuro';
                document.body.classList.add('tema-oscuro');
            } else {
                configuracion.tema = 'claro';
                document.body.classList.remove('tema-oscuro');
            }
            
            localStorage.setItem('configuracion', JSON.stringify(configuracion));
            cargarConfiguracion();
        }

        function guardarConfiguracionEmpresa() {
            configuracion.empresa = {
                nombre: document.getElementById('nombre-empresa').value,
                rif: document.getElementById('rif-empresa').value,
                telefono: document.getElementById('telefono-empresa').value,
                direccion: document.getElementById('direccion-empresa').value
            };
            
            localStorage.setItem('configuracion', JSON.stringify(configuracion));
            alert('ConfiguraciÃ³n de empresa guardada correctamente');
        }

        function respaldarDatos() {
            const datos = {
                inventario: inventario,
                clientes: clientes,
                proveedores: proveedores,
                gastos: gastos,
                empleados: empleados,
                mensajes: mensajes,
                tipoCambio: tipoCambio,
                configuracion: configuracion
            };
            
            const datosStr = JSON.stringify(datos);
            const blob = new Blob([datosStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `respaldo_gestor_empresarial_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Respaldo de datos generado correctamente');
        }

        function restaurarDatos() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const datos = JSON.parse(e.target.result);
                        
                        if (confirm("Â¿EstÃ¡ seguro de restaurar los datos? Esto sobrescribirÃ¡ todos los datos actuales.")) {
                            inventario = datos.inventario || [];
                            clientes = datos.clientes || [];
                            proveedores = datos.proveedores || [];
                            gastos = datos.gastos || [];
                            empleados = datos.empleados || [];
                            mensajes = datos.mensajes || [];
                            tipoCambio = datos.tipoCambio || 168;
                            configuracion = datos.configuracion || {
                                tema: "claro",
                                empresa: {
                                    nombre: "MI EMPRESA",
                                    rif: "J-123456789",
                                    telefono: "(123) 456-7890",
                                    direccion: "Av. Principal, Local #123"
                                }
                            };
                            
                            // Guardar en localStorage
                            localStorage.setItem('inventario', JSON.stringify(inventario));
                            localStorage.setItem('clientes', JSON.stringify(clientes));
                            localStorage.setItem('proveedores', JSON.stringify(proveedores));
                            localStorage.setItem('gastos', JSON.stringify(gastos));
                            localStorage.setItem('empleados', JSON.stringify(empleados));
                            localStorage.setItem('mensajes', JSON.stringify(mensajes));
                            localStorage.setItem('tipoCambio', tipoCambio);
                            localStorage.setItem('configuracion', JSON.stringify(configuracion));
                            
                            // Recargar todas las vistas
                            cargarInventario();
                            cargarClientes();
                            cargarProveedores();
                            cargarGastos();
                            cargarEmpleados();
                            cargarMensajes();
                            cargarConfiguracion();
                            actualizarTipoCambioVisual();
                            
                            alert('Datos restaurados correctamente');
                        }
                    } catch (error) {
                        alert('Error al restaurar los datos: El archivo no es vÃ¡lido');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function eliminarTodosDatos() {
            if (confirm("Â¿ESTÃ ABSOLUTAMENTE SEGURO? Esta acciÃ³n eliminarÃ¡ TODOS los datos y no se puede deshacer.")) {
                localStorage.clear();
                
                // Restablecer todas las variables
                inventario = [];
                clientes = [];
                proveedores = [];
                gastos = [];
                empleados = [];
                mensajes = [];
                tipoCambio = 168;
                historialTipoCambio = [{ fecha: new Date().toISOString().split('T')[0], tasa: 168 }];
                configuracion = {
                    tema: "claro",
                    empresa: {
                        nombre: "MI EMPRESA",
                        rif: "J-123456789",
                        telefono: "(123) 456-7890",
                        direccion: "Av. Principal, Local #123"
                    }
                };
                
                // Recargar todas las vistas
                cargarInventario();
                cargarClientes();
                cargarProveedores();
                cargarGastos();
                cargarEmpleados();
                cargarMensajes();
                cargarConfiguracion();
                actualizarTipoCambioVisual();
                
                cerrarModal('modal-salida');
                alert('Todos los datos han sido eliminados');
            }
        }

        // ===== GUARDAR DATOS =====
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('inventario', JSON.stringify(inventario));
            localStorage.setItem('clientes', JSON.stringify(clientes));
            localStorage.setItem('proveedores', JSON.stringify(proveedores));
            localStorage.setItem('gastos', JSON.stringify(gastos));
            localStorage.setItem('empleados', JSON.stringify(empleados));
            localStorage.setItem('mensajes', JSON.stringify(mensajes));
            localStorage.setItem('tipoCambio', tipoCambio);
            localStorage.setItem('historialTipoCambio', JSON.stringify(historialTipoCambio));
            localStorage.setItem('configuracion', JSON.stringify(configuracion));
        });
    </script>
</body>
</html>
