            const isInputDisabled = !isChatView;
            inputArea.style.opacity = isInputDisabled ? '0.6' : '1';
            inputArea.style.pointerEvents = isInputDisabled ? 'none' : 'auto';
            messageInput.placeholder = isInputDisabled ? 'Selecciona un chat para escribir' : 'Mensaje';

            peerListContainer.classList.toggle('hidden-left', isChatView);
            backToPeersListButton.style.display = isChatView ? 'block' : 'none';
            
            if (isChatView) {
                const peerData = onlineUsers[activeChatPeerId] || {};
                activePeerNameDisplay.textContent = activeChatPeerId;
                activePeerProfilePic.innerHTML = peerData.profilePic ? `<img src="${peerData.profilePic}" alt="${activeChatPeerId}">` : `<i class="fa fa-user"></i>`;
                statusIndicator.textContent = 'En línea'; 
                statusIndicator.classList.add('active');
            } else {
                activePeerNameDisplay.textContent = 'Usuarios en Línea';
                activePeerProfilePic.innerHTML = `<i class="fa fa-users"></i>`; 
                const userCount = Object.keys(onlineUsers).filter(alias => alias !== myAlias).length;
                statusIndicator.textContent = `${userCount} usuario(s) conectado(s)`; 
                statusIndicator.classList.add('active');
            }
        }
        
        function showToast(text, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'message system'; 
            toast.textContent = text;
            
            // Se calcula la posición del toast dinámicamente sobre el área de entrada
            const inputAreaRect = inputArea.getBoundingClientRect();
            const bottomPosition = window.innerHeight - inputAreaRect.top + 10;

            toast.style.cssText = `
                position: fixed; 
                bottom: ${bottomPosition}px; 
                left: 50%;
                transform: translateX(-50%); 
                z-index: 2000;
                opacity: 0; 
                transition: opacity 0.3s ease, bottom 0.3s ease; 
                max-width: 90%;
                background-color: ${type === 'success' ? '#d4edda' : (type === 'error' ? '#f8d7da' : '#e1f2fb')};
                color: ${type === 'success' ? '#155724' : (type === 'error' ? '#721c24' : '#0c5460')};
                padding: 10px 15px; 
                border-radius: 8px; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.style.opacity = '1', 10); 
            setTimeout(() => {
                toast.style.opacity = '0'; 
                toast.addEventListener('transitionend', () => toast.remove()); 
            }, 3500); 
        }
        
        window.addEventListener('load', updateLayout);
    </script>
</body>
</html>
